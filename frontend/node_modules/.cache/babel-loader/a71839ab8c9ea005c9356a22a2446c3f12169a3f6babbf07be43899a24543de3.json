{"ast":null,"code":"import _objectSpread from\"/home/zobair-qauomi/todo_app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{ApolloClient,InMemoryCache,HttpLink,from}from'@apollo/client/core';import{setContext}from'@apollo/client/link/context';import{onError}from'@apollo/client/link/error';const httpLink=new HttpLink({uri:process.env.REACT_APP_GRAPHQL_URL||'http://localhost:4000/graphql',credentials:'same-origin'});const authLink=setContext((_,_ref)=>{let{headers}=_ref;const token=localStorage.getItem('token');return{headers:_objectSpread(_objectSpread({},headers),{},{authorization:token?\"Bearer \".concat(token):''})};});const errorLink=onError(error=>{const{graphQLErrors,networkError}=error;if(graphQLErrors){graphQLErrors.forEach(_ref2=>{let{message,extensions}=_ref2;console.error(\"[GraphQL Error]: \".concat(message));if((extensions===null||extensions===void 0?void 0:extensions.code)==='UNAUTHENTICATED'){localStorage.removeItem('token');localStorage.removeItem('refreshToken');localStorage.removeItem('user');if(window.location.pathname!=='/login'){window.location.href='/login';}}});}if(networkError){console.error(\"[Network Error]: \".concat(networkError.message));}});export const client=new ApolloClient({link:from([errorLink,authLink,httpLink]),cache:new InMemoryCache({typePolicies:{Query:{fields:{projects:{merge(existing,incoming){return incoming;}},tasks:{merge(existing,incoming){return incoming;}}}},Project:{keyFields:['id'],fields:{tasks:{merge(existing,incoming){return incoming;}}}},Task:{keyFields:['id']},GamificationProfile:{keyFields:['id']},PomodoroSession:{keyFields:['id']},Template:{keyFields:['id']}}}),defaultOptions:{watchQuery:{fetchPolicy:'cache-and-network'},query:{fetchPolicy:'cache-first'}}});export const setAuthToken=(token,refreshToken)=>{localStorage.setItem('token',token);if(refreshToken){localStorage.setItem('refreshToken',refreshToken);}};export const clearAuthToken=()=>{localStorage.removeItem('token');localStorage.removeItem('refreshToken');localStorage.removeItem('user');client.clearStore();};export const getAuthToken=()=>{return localStorage.getItem('token');};export const isAuthenticated=()=>{return!!localStorage.getItem('token');};","map":{"version":3,"names":["ApolloClient","InMemoryCache","HttpLink","from","setContext","onError","httpLink","uri","process","env","REACT_APP_GRAPHQL_URL","credentials","authLink","_","_ref","headers","token","localStorage","getItem","_objectSpread","authorization","concat","errorLink","error","graphQLErrors","networkError","forEach","_ref2","message","extensions","console","code","removeItem","window","location","pathname","href","client","link","cache","typePolicies","Query","fields","projects","merge","existing","incoming","tasks","Project","keyFields","Task","GamificationProfile","PomodoroSession","Template","defaultOptions","watchQuery","fetchPolicy","query","setAuthToken","refreshToken","setItem","clearAuthToken","clearStore","getAuthToken","isAuthenticated"],"sources":["/home/zobair-qauomi/todo_app/frontend/src/lib/apollo.ts"],"sourcesContent":["import { ApolloClient, InMemoryCache, HttpLink, from } from '@apollo/client/core';\nimport { setContext } from '@apollo/client/link/context';\nimport { onError } from '@apollo/client/link/error';\n\nconst httpLink = new HttpLink({\n  uri: process.env.REACT_APP_GRAPHQL_URL || 'http://localhost:4000/graphql',\n  credentials: 'same-origin',\n});\n\nconst authLink = setContext((_, { headers }) => {\n  const token = localStorage.getItem('token');\n  return {\n    headers: {\n      ...headers,\n      authorization: token ? `Bearer ${token}` : '',\n    },\n  };\n});\n\nconst errorLink = onError((error) => {\n  const { graphQLErrors, networkError } = error;\n  if (graphQLErrors) {\n    graphQLErrors.forEach(({ message, extensions }) => {\n      console.error(`[GraphQL Error]: ${message}`);\n\n      if (extensions?.code === 'UNAUTHENTICATED') {\n        localStorage.removeItem('token');\n        localStorage.removeItem('refreshToken');\n        localStorage.removeItem('user');\n\n        if (window.location.pathname !== '/login') {\n          window.location.href = '/login';\n        }\n      }\n    });\n  }\n\n  if (networkError) {\n    console.error(`[Network Error]: ${networkError.message}`);\n  }\n});\n\nexport const client = new ApolloClient({\n  link: from([errorLink, authLink, httpLink]),\n  cache: new InMemoryCache({\n    typePolicies: {\n      Query: {\n        fields: {\n          projects: {\n            merge(existing, incoming) {\n              return incoming;\n            },\n          },\n          tasks: {\n            merge(existing, incoming) {\n              return incoming;\n            },\n          },\n        },\n      },\n      Project: {\n        keyFields: ['id'],\n        fields: {\n          tasks: {\n            merge(existing, incoming) {\n              return incoming;\n            },\n          },\n        },\n      },\n      Task: {\n        keyFields: ['id'],\n      },\n      GamificationProfile: {\n        keyFields: ['id'],\n      },\n      PomodoroSession: {\n        keyFields: ['id'],\n      },\n      Template: {\n        keyFields: ['id'],\n      },\n    },\n  }),\n  defaultOptions: {\n    watchQuery: {\n      fetchPolicy: 'cache-and-network',\n    },\n    query: {\n      fetchPolicy: 'cache-first',\n    },\n  },\n});\n\nexport const setAuthToken = (token: string, refreshToken?: string) => {\n  localStorage.setItem('token', token);\n  if (refreshToken) {\n    localStorage.setItem('refreshToken', refreshToken);\n  }\n};\n\nexport const clearAuthToken = () => {\n  localStorage.removeItem('token');\n  localStorage.removeItem('refreshToken');\n  localStorage.removeItem('user');\n  client.clearStore();\n};\n\nexport const getAuthToken = () => {\n  return localStorage.getItem('token');\n};\n\nexport const isAuthenticated = () => {\n  return !!localStorage.getItem('token');\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}